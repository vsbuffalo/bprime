\documentclass[11pt]{article}
\RequirePackage{fullpage}
%\RequirePackage[font=small,labelfont=bf]{caption}
\RequirePackage{amsmath,amssymb,amsthm}
\RequirePackage{graphicx}
\RequirePackage[hidelinks]{hyperref}
\RequirePackage{subcaption}
\RequirePackage{wasysym}
\RequirePackage{authblk}
\RequirePackage{bm}
\RequirePackage{bbm}
%\RequirePackage[osf]{mathpazo}
\let\temp\rmdefault
\RequirePackage{mathpazo}
\let\rmdefault\temp

\RequirePackage[bibstyle=authoryear,citestyle=authoryear-comp,
                date=year,
                maxbibnames=9,maxnames=5,maxcitenames=2,
                backend=biber,uniquelist=false,uniquename=false,
                % style=apa,
                sorting=nyt,
                % sorting=,
                hyperref=true]{biblatex}
\usepackage{color}
\usepackage{nicefrac}

\renewcommand{\P}{\mathbb{P}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\V}{\text{V}}
\DeclareMathOperator{\var}{var}
\DeclareMathOperator{\cov}{cov}

\addbibresource{biblio.bib}

\title{}

\author{Vince Buffalo and Andrew Kern}

\begin{document}
\maketitle

\section*{Introduction}

As genomes are transmitted through the generations, lifetime events selectively
alter what is passed to the next generation. While selection directly acts on
the genetic variants that cause heritable fitness differences among
individuals, neighboring regions experience an indirect contraction in genetic
variability. This byproduct is known as \emph{linked selection}, and it occurs
when selection changes a site's frequency on timescale faster than
recombination can decouple that site from its genetic background. Because
linked selection modifies the genetic variability in a regionally-correlated
way, it creates observable patterns in genomic data that are used to understand
the type of selection processes acting on genomes and estimate key evolutionary
quantities.

Much work has been done on developing mathematical theory for two linked
selection processes: hitchhiking and background selection. What distinguishes
these are the evolutionary processes that generate fitness variation, and the
resulting selection dynamics. Classic hitchhiking models assume new beneficial
variants occur and sweep to fixation (XXX). Theory predicts that classic sweeps
affect diversity on small spatial scales, with characteristic length
$\nicefrac{s}{r}$ basepairs, where $s$ is the heterozygous selection
coefficient and $r$ is the per-basepair recombination rate. Sweeps were found
in humans, \emph{Drosophila}, and other species (XXX), though it was unclear
whether hitchhiking alone could explain the observed genome-wide correlation
between recombination rate and genetic diversity in some species (XXX). Since
the sweeps leave relatively narrow footprint, they influence genome-wide
diversity only when beneficial mutations are recurring and recombination is
relatively limited, as in \emph{Drosophila}. 

By contrast, background selection occurs because of the steady influx of new
deleterious mutations into conserved regions each generation. Since far more
new mutations are deleterious than beneficial in functional regions, it would
seem like background selection would have a dominant role in shaping genetic
diversity. However, deleterious mutations segregate on a timescale inversely
proportional to their selection cost (XXX). Strongly deleterious mutations
eliminate neighboring genetic variability on the few chromosomes they may
recombine onto before the eventual extinction, and consequently have very weak
effects on larger spatial scales. Moderately weakly selected mutations can
persist for much longer periods, allowing for more recombination before their
eventual loss and produce reductions in diversity on shorter spatial scales.
The reduction in diversity under background selection is determined
approximately by $\nicefrac{U}{R}$, where $U = \mu_D L$ is the number of
deleterious mutations (at rate $\mu_D$ per basepair, per generation) in a
conserved region of $L$ basepairs per generation, and $R = r L$, which is the
total recombination per generation in Morgans. Since the deleterious mutation
rate is relatively constant across conserved regions, the reduction due to
background selection closely matches the composition of conserved regions and
recombination along the genome. Remarkably, simple mathematical models of
background selection closely predicts levels of human-chimp divergence at the
megabase scale (XXX) from genome-wide patterns of recombination and regions
conserved between species (McVicker). 







This leads to some of the unidentifiability of hitchhiking versus background
selection.

and the reduction is determined
by 

While the rate
new beneficial mutations enter the population is low (XXX), 

The spatial scale of background selection is 

kkkkkk

not all
adaptation occurs from such new beneficial mutations sweeping to fixation (XXX)


Other processes also act
on beneficial fitness variation to engender linked selection, such as polygenic
selection after an optimum shift \parencite{Buffalo2019-qs,Buffalo2020-my} or
soft sweeps from standing variation (XXX). 

In turn, statistical methods have use this theory for a variety of wide-ranging
empirical problems.  Early on, researchers 

While it is difficult to differentiate the selective processes
leading to linked selection, studies indicate background selection 

hitchhiking events where a low-frequency 

studies
in \emph{Drosophila} and humans indicate background selection has a large role
in shaping patterns of diversity, especially at large spatial scales (i.e.
megabases). 


Another central empirical goal is to estimate the relative strengths of the
these two selection processes on levels of genetic diversity (Eyalshiv). Since
the effects of linked selection are determined in part by mutation rate and
distribution of fitness effects (DFE), these statistical methods also estimate
these important evolutionary parameters from genomic data. These estimates
should, in theory, align with others using different approaches, such as
trio-based estimates of the mutation rate and estimates of the DFE from
site-frequency spectra.

Understanding the extent to which linked selection influences other
evolutionary processes is a central question in evolutionary genetics. Two
central questions have emerged. First, while genetic drift is thought to be the
main source of random fluctuations in neutral allele frequencies, linked
selection can have a similar impact on neutral sites, increasing the variance
in allele frequency change as if the population size were effectively smaller.
Although linked selection causes significant reductions in genetic diversity in
some species, it is unlikely to explain the narrow range of observed diversity
across species \parencite{Buffalo2021-uf}. Second, by perturbing the
frequencies of neighboring alleles, selection can interfere with their
selection dynamics, known as Hill-Robertson interference (HRI, XXX). When
recombination is limited, simultaneous selection across the genome reduces the
odds beneficial mutations are fixed (HRI), effectively like selection was
occurring in an smaller population size. The Hill-Robertson effect is thought
to be weak in organisms in organisms with large recombination maps, perhaps
because of selection for increased recombination.




Our focus here is to begin to fix some deficiencies in the background selection
model. In particular, 

% outline?
- Disentangling evolutionary processes from the patterns of genetic variation
across the genome. The structure of what can be under selection shapes these
patterns when selection acts; when drift acts, these patterns should not exist.

- For species with small effective population sizes (and perhaps large map
lengths), BGS seems to be a dominant selective force in shaping patterns of
diversity (e.g. at the megabase scale in humans).

- However, current approaches to fitting BGS models fail under the weak
selection domain. This weak selection domain is important (discuss
HRI/ratchet/etc). Importantly, the characteristic scale of the impact of linked
selection is $\nicefrac{s}{r}$, meaning weak selection acts on smaller scales
than strong selection. Our ability to see selection at small scales may be
inhibited by the fact that our current BGS theory only works for strong
selection.

- We need to say briefly that we're using BGS to mean linked selection due to
purifying selection, and thus the strong and weak regimes (classically it has
just meant the strong regime).

\section*{Conclusion}

- care should be taken applying these methods to \emph{Drosophila}, since the
$\delta_{LD}$ term could be much larger.

\section*{Results}

\subsection*{Theory}

- overview of why BGS models fail?



even when sites under selection are sparse.

From an evolutionary perspective, linked selection is important because by
modifying neighboring levels of genetic diversity, it is also directly altering
the selection dynamics at these neighboring sites. 

Typically evolutionary genetic models consider 



The other use of these models is to understand how linked selection processes
differentially alter the genetic variability, or equivalently, the genealogical
trees, along the genome. 

XXX how many sites are under selection at any moment? What's fitness variation?



Early on, some pointed out that evidence of strong selective sweeps in the
human genome was not the full story 

Generally, in organisms with large amounts of recombination, linked selection
has 


Weak selection processes 

distorts
genome-wide 

diversity.

The linked selection literature has primarily focused on developing theory for,
and quantifying the effects of two linked selection processes: hitchhiking and
background selection. Genome-wide models of the hitchhiking process consider
how beneficial mutations that sporadically enter the population 

- QGLS polygenic linked selection

- H and W

- inflation factor

\subsection*{Statistical Methods}

\section*{Appendix}

\subsection*{Overview of Theory}

There has been considerable past work to find both the rate of the ratchet
(XXX), and summaries of the genealogies created under weak purifying selection
(XXX). Our approximation combines a few theoretic avenues from past work. Our
primary goal is to find a theoretic scaling function $B$ that rescales the neutral
pairwise coalescent times the appropriate amount to 

Strictly speaking, there is no way to rescale the coalescent under general
background selection process, as genealogies deviate from the Kingman
coalescent slightly under strong selection
\parencite{Walczak2012-fi,Cvijovic2018-vd} and greatly under weak selection
\parencite{OFallon2010-my}

First, we approximate the coalescent effective population size, which
determines expected pairwise diversity, from the variance effective population
size. Then, we use a general quantitative genetic model of linked selection to
find the variance effective population size under background selection. Since
the impact of selection under this model is parameterized by the additive
genetic fitness variance, we use an approximation for this based on the
additive \emph{genic} variance, which depends on the rate of the ratchet.
Previous work has been unable to find a simple closed-form solution to the rate
of the ratchet because it depends on moments of the fitness distribution (e.g.
fitness variation), which in turn depend on even higher-moments of the fitness
distribution (e.g. the skew of the fitness distribution). While the ratchet
should scale with the probability of fixation, the probability of fixation
(Kimura, Malecot, XXX) is not accurate when multiple deleterious mutations are
segregating simultaneously and in close linkage with one another. A key insight
of \textcite{Santiago2016-mu} was that the classic equation for the probability
of fixation is fairly robust as long as the correct effective population size
is used. Their approach is to solve a system of two non-linear equations: one
for the variance effective population size (which depends on the rate of the
ratchet), and another for the time to fixation (which depends on the effective
population size).

Below, we step through the theory we use in our statistical methods. We
re-derive central parts to illustrate where approximations have been made,
which allows us to understand how these approximations may impact our
statistical methods and inspect model fit in regions where these approximations
are less likely to hold.

\subsection*{Pairwise Diversity under Background Selection}

The central quantity of interest for our statistical inference methods is
average pairwise diversity along the chromosome. While other summaries of the
data, such as the allele frequency spectrum, may be more informative about the
evolutionary processes acting in a region, we lack population genetic theory
for these quantities under most selective regimes and they require more degrees
of freedom to characterize. By contrast, neutral diversity under an
infinite-sites model is determined only by the per-basepair mutation rate $\mu$
and the expected pairwise coalescent time $\E[T_2]$,

\begin{align}
  \E(\pi) = 2 \mu \E(T_2)
\end{align}

Let us assume that there is a constant \emph{drift-effective} population size
$N_d$ which determines the rate of coalescence due only to neutral demographic
processes. Additionally, we assume some background selection process that in
expectation scales the effective population size by $b(t)$ at time $t$ (though
this could in theory be due to any process). Then, the expected pairwise
coalescent time is

\begin{align}
  \label{eq:T_2}
  \E(T_2) = \sum_{i=1}^\infty \frac{i}{2 b(i) N_d}\prod_{t=1}^{i-1} \left(1-\frac{1}{2 b(t) N_d}\right).
\end{align}

The time-dependency of $b(t)$ is required because the background selection
process will usually alter the rate of coalesce through time. For example,
under weak and intermediate selection, coalesce rates speed up as lineages move
in the past under intermediate to weak selection, similar to population growth
\parencite{Walczak2012-fi,Seger2010-rs,Good2014-yz}. 

% Intuitively, this is
% because lineages are unlikely to coalesce with numerous less fit lineages they
% encounter as they go back in time, until ultimately coalescing in one of the
% least-loaded fitness classes. 

This formulation is general and classic background selection theory (in the
no-ratchet domain) is a special case of it. Under classic BGS and load theory,
two randomly sampled lineages will each carry a number of deleterious mutations
sampled from a Poisson stationary distribution. Because any lineage carrying $j
> 0$ strongly deleterious mutations is destined to extinction, these lineages
can only coalesce in a common ancestor in the least-loaded class with zero
deleterious mutations. Under the Poisson stationary distribution, the size of
this class is $f_0 N$, where $f_0 = e^{-\nicefrac{U}{s}}$, so the coalescent
rate is scaled by $\nicefrac{1}{f_0}$. Once the lineages reach this fitness
class, there are no fitness differences among individuals, so they coalesce
following the Kingman process. A lineage moves backwards in time $t_d$
generations through the ``delay phase" to the least-loaded class. Classic BGS
theory ignores this delay phase, since $t_d \sim \log(j+1)/s << f_0 N$
(Durrett, p. 213). 

%Here, we model the background selection process forward in time. We approximate
%the expected pairwise diversity with the probability of heterozygosity,
%$\E(\pi) \approx \mathcal{H}$, which holds under weak mutation and random
%mating, such that

%\begin{align}
%  %\mathcal{H} =  2 \mu \sum_{i=1}^\infty \prod_{t=1}^i \left(1-\frac{1}{2 b(t) N_d} \right)
%  \mathcal{H} &= 1 - \sum_{i=1}^\infty (1-\mu)^{2i} \prod_{t=1}^i \left(1-\frac{1}{2 b(t) N_d} \right) \\
%              &\approx 2 \mu \sum_{i=1}^\infty \prod_{t=1}^i \left(1-\frac{1}{2 b(t) N_d} \right)
%\end{align}

%in the limit where $\mu \to 0$. This is equation 4 of
%\textcite{Santiago2016-mu}; they define the sum as the heterozygosity effective
%population size.

\subsection*{Forward in Time Models of Linked Selection}

Next, show how quantitative genetic models of linked selection
\parencite{Robertson1961-ho,Santiago1995-hx,Santiago1998-bs,Santiago2016-mu}
find expressions for $b(t)$ with by modeling the selective process forward in
time. Their approach is to consider how the variance in neutral allele
frequency change is impacted by a linked selection process. 

\subsubsection*{Variance in Neutral Allele Frequency in a Neutral System}

For comparison, we start with the recursion for the variance in allele
frequency change in a neutral Wright--Fisher model. Under binomial sampling of
alleles, the random frequency $x_t$ is $2N x_t \sim \mathrm{Binom}(x_{t-1},
2N)$. If we look forward in time on generation and treat $x_0$ as fixed,

\begin{align}
  \V(x_1) = \E_1\left[(x_1 - x_0)^2\right]= \frac{x_0(1-x_0)}{2N},
\end{align}

and

\begin{align}
  \V(x_2) &= \E\left[(x_2 - x_0)^2\right] \\
          &= \E_1\left[\E_2\left[((x_2-x_1) + (x_1 - x_0))^2 | x_1\right]\right] \\
          &= \E_1\left[\E_2\left[(\Delta x_2 + \Delta x_1)^2 | x_1\right]\right] \\
          &= \E_1\left[\E_2\left[{\Delta x_2}^2|x_1\right]\right] + 2\E_1\left[\E_2[\Delta x_2 \Delta x_1 | x_1]\right] + \E_1\left[ {\Delta x_1}^2\right] \\
          &= \E_1\left[\E_2\left[{\Delta x_2}^2|x_1\right]\right] + \E_1\left[ {\Delta x_1}^2\right] \\
          &= \frac{x_0(1-x_0)}{2N}\left(1 - \frac{1}{2N}\right) + \frac{x_0(1-x_0)}{2N}
\end{align}

Note that the cross-moment $\E_1\left[\E_2[\Delta x_2 \Delta x_1 | x_1]\right]
= 0$ under neutral evolution. In general, the variance in allele frequency
after $t$ generations of neutral evolution is,

\begin{align}
  \label{eq:var_freq}
  %\V(x_t) &= \frac{x_0(1-x_0)}{2N}\left(\sum_{i=1}^t \left(1 - \frac{1}{2N}\right)^{i-1} \right)
  \V(x_t) &= \V(x_1) \left(1 + \sum_{i=1}^t \left(1 - \frac{1}{2N}\right)^{i} \right)
\end{align}

This geometric series converges to the familiar expression,

\begin{align}
  \V(x_t) &= x_0(1-x_0)\left(1 - \left(1 - \frac{1}{2N}\right)^t \right).
\end{align}

which in the limit $t \to \infty$, converges to the Bernoulli variance
$x_0(1-x_0)$ as the frequency either goes to 1 with probability $x_0$ or 0 with
probability $1-x_0$.

% Now, if the effective population size were to change each generation, equation
% \eqref{eq:var_freq} would be,

% \begin{align}
%   \V(x_t) &= \V(x_0) \left(1 + \sum_{i=1}^t \prod_{j=1}^{i} \left(1 - \frac{1}{2N(j)}\right) \right)
% \end{align}

% Note that this too converges to $x_0(1-x_0)$ as $t \to \infty$.

\subsubsection*{Variance in Neutral Allele Frequency with Linked Selection}

Note that equation XXX is a special case, when the evolutionary process has
independent allele frequency changes through the generations and thus the
cross-moment is zero. Selection generates correlations between allele frequency
changes at nearby neutral sites. These correlations created by linked selection
inflate the variance in neutral allele frequency $\V(x_t)$ beyond what it would
be in a system without linked selection operating. The magnitude of this
inflation term is set by the selection process and its dynamics, linkage
disequilibrium, and the recombination rate. Even k




The theory of this began with \textcite{Robertson1961-ho},
and was thoroughly worked out by Santiago and Caballero
(\citeyear{Santiago1995-hx}, \citeyear{Santiago1998-bs}; see also
\cite{Barton2000-zg} and \cite{Buffalo2019-qs}). Our BGS statistical methods
employ the extension of this model for weak BGS \parencite{Santiago2016-mu}.
For completeness, we step through a quick derivation of the linked selection
inflation factor models here, based on
\textcite{Santiago1995-hx,Santiago1998-bs}.

Quantitative genetic models of linked selection



%%%%%

One way we can model these dependencies is to partition $\Delta_i$ into drift
and selection components. Over evolutionary replicates, the drift components
are independent and the selection components have some degree of
autocorrelation. Let us partition $\Delta x_i = \Delta_S x_i + \Delta_D x_i$,

\begin{align}
  \V(x_2) &= \V\left(\Delta x_2 + \Delta x_1\right) \\
          &= \V(\Delta_D x_2) + \V(\Delta_D x_1) + 2 \cov(\Delta_S x_2, \Delta_S x_1) \\
          &= \frac{x_0(1-x_0)}{2N}\left(1 - \frac{1}{2N}\right) + \frac{x_0(1-x_0)}{2N} +  2 \cov(\Delta_S x_2, \Delta_S x_1) 
\end{align}

since $\Delta_D x_i \perp \Delta_D x_j$ for $i \ne j$. The covariances are
determined by the selective process dynamics, linkage disequilibrium, and the
recombination rate. These covariances are throughly worked out in
\textcite{Santiago1995-hx} and \textcite{Buffalo2019-qs}, so we give a short
derivation here. Throughout, we assume random mating, hermaphroditic
individuals, and a constant population size. We will use angular brackets to
indicate an average over all diploid individuals in the population, of some
value with an individual-level index. For example, if we denote the number of
allele an individual carries in generation $t$ as $z_{t,i} \in \{0, 1, 2\}$,
the population frequency at time $x_t$ is

\begin{align}
  x_t = \langle z_t \rangle = \frac{1}{2N} \sum_{i=1}^N z_{t,i}
\end{align}

Across evolutionary replicates, each parent $i$ passes one of their two neutral
alleles to a random number $k_i$ offspring. The \emph{heritable fitness} of an
individual $f_i$ is defined as the expected number of offspring passed down
across evolutionary replicates, such that $k_i = f_i + \varepsilon_i$.  Some
selection process determines the distribution of $f_i$, but the this occurs
independently of the process that sorts neutral alleles into diploid
individuals. We are unsure of the neutral allele count in an individual in the
initial generation, $z_{t,0}$, so we condition on it and take expectations
later. Then, the frequency in the initial and first generations are,

\begin{align}
  x_0 = \langle z_0 \rangle = \frac{1}{2N} \sum_{i=1}^N z_{0,i} \\
  x_1 = \langle z_1 \rangle = \frac{1}{2N} \sum_{i=1}^N \left( k_i \frac{z_{0,i}}{2} + \sum_{j=1}^{k_i} \delta_{i,j} \right)
\end{align}

The first term is the average number of neutral alleles each parent passes to
its $k_i$ offspring. In reality, alleles are discrete, so each heterozygous
parent also passes a random $\pm \nicefrac{1}{2}$ to each offspring, which
leads to the second term. The variable $\delta_{i,j}$ is 0 if the parent is a
homozygote, but if the parent is a heterozygote, is $\pm \nicefrac{1}{2}$ with
equal probability over evolutionary replicates.

Since individuals are exchangeable with their contribution to the
heterozygosity term and population size is constant,

\begin{align}
  \sum_{i=1}^N \sum_{j=1}^{k_i} \delta_{i,j} = \sum_{i=1}^N \delta_{i} 
\end{align}

We can further partition the offspring number into heritable and non-heritable
parts,

\begin{align}
  x_1 &= \frac{1}{2N} \sum_{i=1}^N \left( (f_i + \varepsilon_i) \frac{z_{0,i}}{2} + \delta_{i} \right) \\
      &= \frac{1}{4N} \sum_{i=1}^N f_i z_{0,i} + \frac{1}{4N} \sum_{i=1}^N \varepsilon_i z_{0,i} + \frac{1}{2N} \sum_{i=1}^N \delta_{i} \\
      &=  \frac{1}{4} \langle f \; z_{0} \rangle + \frac{1}{4} \langle \varepsilon \; z_{0} \rangle + \frac{1}{2}\langle \delta \rangle \\
\end{align}

% TODO factor 1/2 error

\begin{align}
  x_1 - x_0 &= \frac{1}{4} \langle f \; z_{0} \rangle + \frac{1}{4} \langle \varepsilon \; z_{0} \rangle + \frac{1}{2}\langle \delta \rangle - \langle z_0 \rangle \\
            &= \frac{1}{4} \langle (f-1) \; z_{0} \rangle + \frac{1}{4} \langle \varepsilon \; z_{0} \rangle + \frac{1}{2}\langle \delta \rangle 
\end{align}

Now, we look at the variance of this over evolutionary replicates. By symmetry,
the expected change in a neutral allele is $\E(\Delta x_t) = 0$ since we track
an arbitrary neutral allele. Then the variance $\V(\Delta x_1) = \E( {\Delta
x_1}^2)$,

\begin{align}
  \V(\Delta x_1) &= \frac{1}{4} \langle (f-1) \; z_{0} \rangle + \frac{1}{4} \langle \varepsilon \; z_{0} \rangle + \frac{1}{2}\langle \delta \rangle 
\end{align}


OLD
Let us imagine there is some stochastic process $b(t)$ that rescales the coalescent
rate, 

\begin{align}
  \V(x_t) &= \frac{x_0(1-x_0)}{2N(0)}\left(\sum_{i=1}^t \prod_{j=1}^{i-1} \left(1 - \frac{1}{2b(j)N}\right) \right)
\end{align}



\begin{align}
  \var(p_3 - p_0) = \E & \left( \bigg( \underbrace{S_1(1 + (1-r) G + (1-r)^2 G^2)}_{\text{creation and persistence of generation 1 associations} \;\; := \; S_1 Q_3} \right. +  D_1 + H_1+ \nonumber \\
                       & \underbrace{S_2(1 + (1-r) G)}_{\text{creation and persistence of generation 2 associations} \;\; := \; S_2 Q_2}+ D_2 + H_2 + \nonumber \\
                       &  \underbrace{S_3}_{\text{creation of generation 3 associations} \;\; := \; S_3 Q_1  }\left. + D_3 + H_3 \bigg)^2 \right). &
    \label{eq:scr-var2}
\end{align}
%

Note the similarity between the equations.

\begin{align}
  V &\propto \frac{1}{2b(0)N_d}\left(\sum_{i=1}^\infty \prod_{t=1}^{i-1} \left(1 - \frac{1}{2b(t)N_d}\right) \right) \\
  W &\propto \sum_{i=1}^\infty \frac{i}{2 b(i) N_d} \prod_{t=1}^{i-1} \left(1-\frac{1}{2 b(t) N_d}\right) \\
\end{align}


Let us define the function $a(t)$ to be the product, which is the cumulative
failure to coalesce up to time $t$.

\begin{align}
  a(t) = \prod_{i=1}^{t-1} \left( 1-\frac{1}{2 b(i) N_d} \right)
\end{align}

Comparing this to equation \eqref{eq:T_2} up to constant factors, 

\begin{align}
  V &\propto \sum_{i=1}^\infty a(t) \\
  W &\propto \sum_{i=1}^\infty i \; a(t) \\
\end{align}

end{align}

XXX we swap indices

Now, if we assume that the final coalesce in the waiting time process were to
have a fixed rate of $\nicefrac{1}{2b(0)N_d}$, this 

we see that both the waiting time process and the variance process 

Intuitively, these define a stochastic selection process in two ways through
the function $b(t)$ that modulates the rate of pairwise coalesce. 







where if $N_e(t) = N_e$ and $t=1$, this is the familiar Wright--Fisher variance
$\V(p_1) = p_0(1-p_0) / 2N_e$. When selection is not acting, allele frequency
changes per generation are independent, and neutral diversity is set by this
single $N_e$. 

XXX

Since we track an arbitrary neutral allele's frequency $p_i$, by symmetry,
linked selection has no impact on the direction of change, $\E(\Delta p_i) =
0$. We will work through a short proof of $\V(p_t)$ by induction following the
approach of \textcite{Santiago1995-hx}. Throughout, we will use angular
brackets to indicate an average over all diploid individuals in the population,
of some value with an individual-level index. For example, if we denote the
number of allele an individual carries in generation $t$ as $x_{t,i} \in \{0,
1, 2\}$, the population frequency at time $p_t$ is

\begin{align}
  p_t = \langle x_t \rangle = \frac{1}{N} \sum_{i=1}^N x_{t,i}
\end{align}


\begin{align}
  \Delta_H p &= \langle x (f-1) \rangle \\
  \Delta_N p &= \langle x d \rangle \\
  \Delta_M p &= \langle \Delta \rangle \\
\end{align}

Assuming uninherited, random environments, only the $\Delta_{_H} p$ terms
create autocorrelation in $p_t$. The autocorrelation is created because during
the random pairing of neutral alleles to fitness backgrounds, associations are
created between an individual $i$'s allele frequency and their fitness $f_i$.
This is because both fitness and the neutral alleles reside in the same
individual in the present generation. 

We can imagine now how these associations change over evolutionary replicates
in the next generation. In a fraction $r$ of the cases, the neutral allele 
recombines off (or segregates away, if they are on different chromosomes) the
fitness background. In a faction of $1-r$ XXX

\begin{align}
  \cov(\Delta_H p_t, \Delta_H p_s) &= \E(\langle x_t (f_t-1) \rangle , \langle x_s (f_s-1) \rangle)
\end{align}

Note that this covariance is only 


In the first generation, the frequency change
can be partitioned into three components. Conditioning on the parent's
heritable fitnesses, we can imagine constructing an infinite number of
evolutionary replicates. Across all replicates, a random neutral allele's is
perturbed 

\begin{align}
  p_1 - p_0 = \sum_{i=1}^{N} 
\end{align}



Since the variance in neutral allele frequency change is also determined by the
pairwise coalescence rate, this provides us with a way to model $b(t)$ under
linked selection.




These models derive an expression for the variance-effective population size of
a focal neutral site, $N_v(t)$, based on how linked fitness variation perturbs
the frequency trajectory at this site.  The variance-effective population size
for a constant $N_e$ is defined by the variance in allele frequency change at
the neutral site, over evolutionary replicates, 

where if $t=1$, this is the familiar Wright--Fisher variance $\V(p_1) =
p_0(1-p_0) / 2N_e$. When selection is not acting, allele frequency changes per
generation are independent, and neutral diversity is set by this
single $N_e$. 

However when selection is acting at linked sites, neutral diversity is
determined by the long-run $\V(p_t)$ as $t \to \infty$. Intuitively, this is
because the rate of drift is magnified by autocorrelation in allele frequency
change (XXX), and diversity is determined by the cumulative impact of these
autocorrelations in the long-run. This autocorrelation effectively reduces the
coalescence rate in a time-dependent manner, analogous to equation
\eqref{eq:T_2}. Thus, a single constant $N_e$ is insufficient to describe
levels of neutral variation, since it is insufficient 

The variance in allele frequency change after $t$ generations is

\begin{align}
  \V(p_t) = p_0(1-p_0)\left(1 - \prod_{i=1}^t \left(1-\frac{1}{2N_e(t)}\right)\right)
\end{align}

This is the basis of the quantitative genetic models of linked selection: a
forward in time model for $\V(p_t)$ implies a pairwise coalescence rate
function $b(t)$, which determines statistics based on pairwise coalescence such
as $\E(\pi)$.

Next, we consider how fitness variation impacts $\V(p_t)$.



Throughout, we will take the variance $\V(p_t)$ to be the variance over
evolutionary replicates. Since the variance is for a random neutral allele's
frequency, 






a reasonable approximation to how background selection process
rescales the coalescent rate at this site is given by $b(t) =
\nicefrac{N_v(t)}{N_d}$. 


\begin{align}
  N_v = \lim_{t \to \infty} \frac{p_0 (1 - p_0) - \var(p_{t-1})}{2\var(p_t) - \var(p_{t-1})}
\end{align}

\subsection*{Linked Selection Models for Variance-Effective Population Size}

We wish to derive an expression for the reduction factor $B$. Ideally, this
reduction factor would rescale the coalescent-effective population size, but
this would require knowing the coalescent rate function $\lambda(t)$ over the
evolutionary history $0 < t < \infty$. Instead, following previous work
\parencite{Santiago1995-hx,Santiago1998-bs}, we derive the rescaling function
$B$ relative to the variance-effective population size.

Following past quantitative genetic models of linked selection
\parencite{Robertson1961-ho,Santiago1995-hx,Santiago1998-bs,Santiago2016-mu},
we consider the long-run variance effective population size, 

\begin{align}
  N_v := \lim_{t \to \infty} \frac{p_0(1-p_0)}{2\var\left(p_t - p_0\right)}
\end{align}





% ADD TO INTRO TODO
Comment about characteristic scale $\nicefrac{\mu}{s}$. Is the fact that we see
BGS on megabase scales because this is the only scale we can detect strong
selection under?


approximately $\pi \approx 4N_e \mu$ (for low mutation rate). However, this
assumes a constant Kingman coalescent with coalescent effective population size
$N_e$. 

\subsection*{}

We model the reduction in pairwise coalescence times along the genome due to
background selection by extending the work of \textcite{Santiago2016-mu}
(hereafter, the SC16 model). The SC16 model derives from a class of linked
selection \parencite{Robertson1961-ho,Santiago1995-hx,Santiago1998-bs} that
predict the reduction in pairwise coalescence time at a focal neutral site
using macro-state parameters such as fitness variation, rather than micro-state
parameters like the frequency trajectories of selected alleles (e.g.
\textcite{Maynard_Smith1974-zr}). We will briefly introduce the SC16 model's
approach and how we validated this model could be extended to whole-genome
inference.

Classic background selection theory models how coalescence times are reduced by
deleterious mutation-selection balance at neighboring sites. Building upon
older models of genetic load \parencite{Crow1970-wj,Kimura1966-bk}, these
models consider the equilibrium distribution of the \emph{number} of
deleterious mutations segregating on haplotypes
\parencite{Charlesworth1993-gb,Nordborg1996-nq}. Given an infinitely large
population, or sufficiently strong selection, the deleterious mutations in
these models cannot fix; consequently, any lineage containing 

While the effect of selection on linked selection distorts neighboring
genealogies (XXX), skewing the site frequency spectrum (XXX) and altering
linkage disequilibria along the chromosome, we focus on the impact of selection
on pairwise coalescence rates. This simple summary is amenable to mathematical
and statistical inference, and is robust to difficulties in identifying rare
variants. The effect of background selection on pairwise coalescence rates is
expressed as the reduction ratio $B = \nicefrac{N_e}{N}$ where $N$ is the
drift-effective population size (i.e. including demographic processes) and
$N_e$ is the effective population size under background selection.

Under quantitative genetic models of linked selection, the reduction in
effective population size is determined by the product of fitness variation,
$V_f$, and an inflation factor $Q$. It is helpful to understand this by comparing
it to a model of $N_e$ without \emph{heritable} fitness variation but with
\emph{non-heritable} fitness variation. In this case, 

\begin{align}
  N_e = \frac{4N}{2 + V_k},
\end{align}

where $V_k$ is the variance in offspring number across individuals. Under a
constant population size Wright--Fisher model of reproduction, $V_k \approx 2$,
and this simplifies to $N_e = N$. However, as first noted by
\textcite{Robertson1961-ho}, linked selection inflates the variance in
offspring number, as a neutral allele that becomes associated with a
high-fitness or low-fitness genetic background has an $1-r$ chance of remaining
associated with that background in the next generation, where $r$ is the chance
of recombination (or independent assortment, $r=\nicefrac{1}{2}$). 


This persistence of this association inflates the effective variance in fitness
by a factory $Q^2$, 

\begin{align}
  N_e = \frac{4N}{2 + V_k + 4 Q^2 V_f},
\end{align}


\begin{align}
  N_e = \frac{4N}{2 + V_k + 4 Q(r)^2 V_f},
\end{align}




\begin{align}
  N_e = N \exp\left(-Q^2 V_f\right)
\end{align}

In a region of $L$ basepairs under purifying selection, there is a net flux of
deleterious mutations in at rate $U = 2 \mu L$ per generation (where the factor
of two is because in diploids, $2L$ is the total number of basepairs per genome). 

Typical models of background selection consider the equilibrium distribution of
the \emph{count} of deleterious mutations, rather than then level of fitness
variation implied by this count. If we assume fixed additive effects across
alleles and multiplicative fitness effects across loci, each copy of a
deleterious mutation an individual carries reduces their fitness by a factor of
$1-s$. The total reduction for an individual is

\begin{align}
  x = (1-s)^n
\end{align}

where $n$ is the number of deleterious alleles an individual carries. Under
mutation-selection balance, the population evolves to either a stationary
distribution under the strong BGS domain, or a traveling distribution in weak
selection case. Under some assumptions, equilibrium models of the strong domain
show that the distribution $f(n) \sim \text{Pois}(\nicefrac{U}{s})$
\parencite{Kimura1966-bk,Crow1970-wj} (CHECK) in the asexual case, and the
fixation rate of deleterious mutations per generation, or ratchet rate, is $R =
0$ since the probability of fixation, $p_F$ is zero. By contrast, as the
selection coefficient grows weaker, $s \to 0$, the probability of fixation $p_F
\to \nicefrac{1}{2N}$, and the ratchet approaches the neutral rate of $R =
\mu$. The weak selection domain is of importance because both because it
implies a certain likely irreversible rate of fitness reduction, and because it
could possibly confound population genetic inference which assumes dynamics
only under the strong model.

As $s \to 0$, the fitness distribution, put on a scale reflecting the fitness
relative at one moment in time, travels leftwards and changes shape. It has
been difficult to find dynamic equations for the rate of the ratchet and
fitness distribution, since lower moments of the distribution, such as the
variation, depend on higher moments, such as the skew
\parencite{Good2013-lp,Haigh1978-gt,Higgs1995-xc}. This is known as the ``moment
closure problem" and it occurs regardless of whether one models the count
number of deleterious mutations (XXX) or the fitness distribution (XXX).

We can approximate the mapping between the distribution of deleterious
mutations in the population, and the fitness distribution. It is worth noting
that the count of deleterious mutations in an individual $i$ can be written
$n_i = \sum_l^{L} g_l$ where each $g_l$ is an indicator variable for whether
the individual carries a mutation at position $l$. Then, $\V_i(n) = \sum_l
\V(g_l) + \sum_{i,j}\cov(g_i, g_j)$.

the
number of deleterious mutations in gamete $i$; thus $V(n) = \sum_i^{2N} V(x_i)
+ \sum_{i \ne j} \cov(x_i, x_j)$ where the last term is the correlation among
gamete mutation counts, which is an LD quantity. Then, assuming $s$ is small,
we can write express this in terms of the additive genetic variance, 

\begin{align}
  V(f) &\approx s^2 \V_a(n) + \Delta_\text{LD}
\end{align}

The first term is the additive genic variance, which is 


Under this model, the rate of the ratchet $R = U  - s V(n)$, which implies,

\begin{align}
  R = U - \nicefrac{V(f)}{s} \\
  V(f) = s(U - R)
\end{align}



Throughout, it's worthwhile to keep into mind many population-level
macro-states are simply distributional summaries of the current population. For
example, the variance in deleterious mutations in the population is simply,
$\V(n) = \nicefrac{1}{2N} \sum_i (x_i - \mu_x)^2$





- We need to mention the two heterozygosities (S\&C '16 says they diverge under
$N_e s < 1$ -- could explain anything we see?)

- A point about reconciling the two micro and macro-state theories of
population and quantitative genetics.





\subsection*{The Rate of the Ratchet}


\section*{Methods}

\subsection*{Data Preprocessing}

\subsection*{Human}

Site-level neutral and accessibility masks

Bin-level masks based on fraction of accessible bases in a window (7\%).

Bin-level tail filtering.

\printbibliography

\end{document}

% A central goal of evolutionary genetics is to quantify the relative roles
% different evolutionary processes have on genetic variation. Certain
% evolutionary processes, such as demographic bottlenecks or expansions, act
% uniformly across the genome as a whole. Other processes, such as selection, are
% hypothesized to act differently across the genome depending on the density of
% genomic features, and local heterogeneity in recombination and mutation rate.
% With the emergence of population genomic data, a variety of statistical models
% have teased apart the contribution of these various processes. These
% statistical models differ in how they reduce large genomic data to summary
% statistics, as well as in their statistical methodology. Some models reduce
% genomic data to the histograms of the frequency spectrum (XXX), while others
% model scalar summaries of the frequency spectrum along the genome. 

% One class of models, parametric statistical models, leverage population genetic
% theory to inform expectations of the mean pairwise diversity along the
% chromosome. Estimation under these models often uses a composite likelihood
% approach, where the joint distribution is assumed independent across positions.
% While composite likelihoods are simpler to formulate and lead to consistent
% parameter estimation, ignoring dependencies between neighboring sites has two
% primary disadvantages. First, unlike proper likelihoods, the composite
% likelihood's curvature is uninformative about parameter estimate uncertainty.
% Previous work has circumvented this shortcoming through (1) resampling-based
% uncertainty estimates, or (2) adjusting the composite likelihood's curvature to
% account for these dependencies. Second, similar to inference under phylogenetic
% comparative models, the dependency structure tells us how to properly weight
% information across sites. For example, imagine a conserved segment 10 kilobases
% long right on the border of two genomic bins, which due to linked selection,
% bot experience a reduction in diversity. When estimating parameters, the
% independence assumption of composite likelihoods would weight these observed
% reductions equal to the amount of a reduction observed on an entirely different
% independent chromosome. 

% patterns of genetic variability along the genome are treated as
% coming from an indeprocess $m(z)$.


% Here, we focus on solving an issue processes: background

% BGS as evolution around the static features of the genome. Due to the slow rate
% of genomic structural evolution, much of the genome can be treated as static
% throughout the genome. These regions are under differing levels of selective
% constraint, which induces background selection at neighboring regions.


% Signal processing

% Genomes have inherent structure that impacts the linked selection map. There is
% tremendous heterogeneity across species in the organization of likely selected
% regions on the genetic and physical maps.

% Within an organism, there are two key determinants of B maps: recombination and
% gene density. 

% Initially, the relationship between recombination and diversity was regressed
% with no regard to the spatial organization of the genome.

% Certain regions are pinchpoints of selection: some combination of low
% recombination and high gene density lead to very strong reductions in genetic
% diversity. In these regions, coalescent dynamics change considerably; where as
% under strong background selection, deleterious alleles would not fix, in these
% regions the can fix. Additionally, the selective interference impacts positive
% selection.


